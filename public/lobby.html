<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>SCOUT â€“ ë…¼ì•Œì½œ ë¹„í¡ì—° ëŒ€ê¸°ì‹¤</title>
<link rel="stylesheet" href="style.css">

<style>
#roomBox {
  background:#222;
  padding:20px;
  max-width:420px;
  margin:0 auto;
  border-radius:15px;
  text-align:center;
  margin-top:40px;
}
.playerItem {
  background:#333;
  padding:10px;
  border-radius:10px;
  margin:8px 0;
}
.ready { color:#00ff99; font-weight:bold; }
.notReady { color:#ff5555; font-weight:bold; }
</style>
</head>
<body>

<div id="roomBox">
  <h2>ğŸ´ SCOUT â€“ ëŒ€ê¸°ì‹¤</h2>

  <div>ë°© ID: <span id="roomId"></span></div>
  <button id="copyBtn">ì´ˆëŒ€ ë§í¬ ë³µì‚¬</button>

  <h3>ì°¸ì—¬ì ëª©ë¡</h3>
  <div id="playerList"></div>

  <button id="readyBtn">ì¤€ë¹„</button>
  <button id="startBtn" disabled>ê²Œì„ ì‹œì‘</button>
</div>

<script src="/socket.io/socket.io.js"></script>
<script type="module">
const params = new URLSearchParams(location.search);
const roomId = params.get("room");
let nickname = params.get("name");

document.getElementById("roomId").innerText = roomId;

const socket = io();
socket.emit("joinRoom", {roomId, nickname});

// ê³µìœ  ë²„íŠ¼
document.getElementById("copyBtn").onclick = () => {
  const link = `${location.origin}/room.html?room=${roomId}`;
  navigator.clipboard.writeText(link);
  alert("ì´ˆëŒ€ ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!");
};

// ìƒíƒœ í‘œì‹œ
let players = {};
let myUid = null;

// ë‚´ uid
socket.on("connect", () => { myUid = socket.id; });

// ì°¸ê°€ ëª©ë¡ ê°±ì‹ 
socket.on("playerListUpdate", (p) => {
  players = p;
  renderPlayers();

  const everyoneReady = Object.values(players).every(pl => pl.ready);
  const isHost = players[myUid]?.isHost;

  // ë°©ì¥ + ëª¨ë‘ ì¤€ë¹„ë¨ â†’ ê²Œì„ ì‹œì‘ ë²„íŠ¼ í™œì„±í™”
  document.getElementById("startBtn").disabled = !(everyoneReady && isHost);
});

// í”Œë ˆì´ì–´ ë Œë”ë§
function renderPlayers(){
  const box = document.getElementById("playerList");
  box.innerHTML = "";

  Object.values(players).forEach(p => {
    box.innerHTML += `
      <div class="playerItem">
        <b>${p.nickname}</b> 
        <span class="${p.ready ? 'ready' : 'notReady'}">
          ${p.ready ? "READY" : "WAIT"}
        </span>
      </div>
    `;
  });
}

// ì¤€ë¹„í•˜ê¸°
document.getElementById("readyBtn").onclick = () => {
  socket.emit("playerReady", {roomId});
};

// ë°©ì¥ì´ ê²Œì„ ì‹œì‘
document.getElementById("startBtn").onclick = () => {
  socket.emit("forceStartGame", {roomId});
};

// ì„œë²„ì—ì„œ ê²Œì„ì‹œì‘ ì‹ í˜¸ ì˜¤ë©´ ì´ë™
socket.on("goGame", () => {
  location.href = `game.html?room=${roomId}&name=${nickname}`;
});
</script>

</body>
</html>

