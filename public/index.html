<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ğŸ´ ìŠ¤ì¹´ìš°íŠ¸</title>
<link rel="stylesheet" href="style.css" />
</head>

<body>

<!-- ======================== -->
<!-- START PAGE -->
<!-- ======================== -->
<div id="startPage" class="page visible">
  <div class="board-panel panel-center">
    <h1 class="game-title">ğŸ´ ìŠ¤ì¹´ìš°íŠ¸ ğŸ´</h1>

    <div id="startHandPreview" class="start-hand-preview" aria-hidden="true"></div>

    <input id="nicknameInput" placeholder="ë‹‰ë„¤ì„ ì…ë ¥" class="input-box">

    <button id="makeRoomBtn" class="btn-main">ë°© ë§Œë“¤ê¸°</button>
    <button id="enterRoomBtn" class="btn-sub">ì´ˆëŒ€ ë§í¬ë¡œ ì…ì¥</button>
  </div>
</div>

<!-- ======================== -->
<!-- ROOM PAGE -->
<!-- ======================== -->
<div id="roomPage" class="page">
  <div class="board-panel wide">
    <h2 id="roomTitle" class="title-board"></h2>

    <div id="playerList" class="player-list-board"></div>

    <div class="room-bottom-row">
      <button id="readyBtn" class="btn-main">ê²Œì„ ì¤€ë¹„</button>
      <button id="startGameBtn" class="btn-green" style="display:none;">ê²Œì„ ì‹œì‘</button>
      <button id="copyInviteBtn" class="btn-sub">ì´ˆëŒ€ ë§í¬ ë³µì‚¬</button>
    </div>
  </div>
</div>

<!-- ======================== -->
<!-- GAME PAGE -->
<!-- ======================== -->
<div id="gamePage" class="page">

  <h2 id="roundInfo" class="title-board"></h2>

  <div class="game-layout">

    <!-- í”Œë ˆì´ì–´ ë¦¬ìŠ¤íŠ¸ -->
    <div id="gamePlayerList" class="sideBoard"></div>

    <!-- ë©”ì¸ ë³´ë“œ -->
    <div class="mainBoard">

      <h3 class="section-title">í…Œì´ë¸”</h3>
      <div id="tableArea" class="tableBoard"></div>

      <h3 class="section-title">ë‚´ íŒ¨ (<span id="myCount">0</span>)</h3>

      <!-- íŒ¨ ë°©í–¥ ì„ íƒ -->
      <div id="flipSelectArea" class="flip-area hidden">
        <h3 class="section-title">íŒ¨ ë°©í–¥ ì„ íƒ</h3>
        <button id="flipToggleBtn" class="btn-main">â†º ë°©í–¥ ë°”ê¾¸ê¸°</button>
        <br><br>
        <button id="flipConfirmBtn" class="btn-green" style="margin-top:10px;">âœ” ë°©í–¥ í™•ì •</button>
      </div>

      <!-- ì†íŒ¨ -->
      <div id="handArea" class="handBoard"></div>

      <!-- ë²„íŠ¼ -->
      <div class="action-row">
        <button id="showBtn" class="btn-main same">SHOW</button>
        <button id="scoutBtn" class="btn-orange same">SCOUT</button>
        <button id="showScoutBtn" class="btn-purple same">SHOW & SCOUT</button>
      </div>
    </div>
  </div>

  <!-- SCOUT ëª¨ë‹¬ -->
  <div id="scoutModal" class="modal hidden">
    <div class="modal-box">
      <p style="margin-bottom:12px;">ì–´ë–»ê²Œ ê°€ì ¸ì˜¬ê¹Œìš”?</p>
      <button id="modalKeep" class="btn-green small">ê·¸ëŒ€ë¡œ ê°€ì ¸ì˜¤ê¸°</button>
      <button id="modalReverse" class="btn-orange small">ë°˜ëŒ€ë¡œ ê°€ì ¸ì˜¤ê¸°</button>
      <br><br>
      <button id="modalClose" class="btn-sub small">ë‹«ê¸°</button>
    </div>
  </div>

  <!-- ì‚½ì… ìœ„ì¹˜ ëª¨ë‹¬ -->
  <div id="insertModal" class="modal hidden">
    <div class="modal-box" id="insertModalContent"></div>
  </div>

</div>

<!-- ========================================================= -->
<!-- ì´ˆëŒ€ ë§í¬ ìë™ ì…ì¥ -->
<!-- ========================================================= -->
<script>
window.addEventListener("DOMContentLoaded", () => {
  const params = new URLSearchParams(location.search);
  const invitedRoom = params.get("room");

  if (invitedRoom) {
    window.roomId = invitedRoom;
    window.permUid = crypto.randomUUID();
    window.showPage("startPage");
    document.getElementById("nicknameInput").focus();
    roomTitle.innerText = `ë°©ë²ˆí˜¸: ${invitedRoom}`;
  }
});
</script>

<!-- ========================================================= -->
<!-- ì‹œì‘ í™”ë©´: ì†íŒ¨ ë¯¸ë¦¬ë³´ê¸° (ë°˜ ê²¹ì¹¨ / ë¶€ì±„ê¼´) -->
<!-- ========================================================= -->
<script type="module">
  import { drawScoutCard } from "./cardEngine.js";

  const holder = document.getElementById("startHandPreview");
  if (holder) {
    // a nice looking, valid-ish mix (top/bottom can be any 1..10 in this UI-only preview)
    const pairs = [
      [1, 6], [2, 9], [3, 7], [4, 10], [5, 8], [6, 9], [7, 10]
    ];

    const mid = (pairs.length - 1) / 2;
    const gap = 44;          // overlap amount (px)
    const tilt = 5.5;        // max rotation (deg)
    const lift = 7;          // vertical fanning (px)

    holder.innerHTML = "";
    pairs.forEach(([t, b], i) => {
      const card = drawScoutCard(t, b);
      const rel = i - mid;
      const rot = (rel / mid) * tilt;
      const y = -Math.abs(rel) * (lift / (mid || 1));

      card.style.transform = `translateX(${i * gap}px) translateY(${y}px) rotate(${rot}deg) scale(0.92)`;
      card.style.zIndex = String(10 + i);
      holder.appendChild(card);
    });
  }
</script>

<!-- ========================================================= -->
<!-- ğŸ’§ ëŒ€ê°ì„  ë¬¼ê²° clipPath (SCOUT ìŠ¤íƒ€ì¼) -->
<!-- ========================================================= -->
<svg width="0" height="0" style="position:absolute">
  <defs>
    <clipPath id="diagonal-wave" clipPathUnits="objectBoundingBox">
      <path d="
        M0,0
        L0.12,0
        C0.30,0.15 0.50,0.35 0.70,0.55
        L1,1
        L0,1
        Z
      " />
    </clipPath>
  </defs>
</svg>

<!-- ========================================================= -->
<!-- MODULE SCRIPTS (ë§¨ ì•„ë˜ ë°°ì¹˜) -->
<!-- ========================================================= -->
<script src="/socket.io/socket.io.js"></script>
<script type="module" src="./socket.js"></script>
<script type="module" src="./roomUI.js"></script>
<script type="module" src="./gameUI.js"></script>

</body>
</html>
