<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<title>🎴 스카우트</title>
<link rel="stylesheet" href="style.css" />
</head>

<body>

<!-- ======================== -->
<!-- START PAGE               -->
<!-- ======================== -->
<div id="startPage" class="page visible">
  <div class="board-panel panel-center">
    <h1 class="game-title">🎴 스카우트 🎴</h1>

    <input id="nicknameInput" placeholder="닉네임 입력" class="input-box">

    <button id="makeRoomBtn" class="btn-main">방 만들기</button>
    <button id="enterRoomBtn" class="btn-sub">초대 링크로 입장</button>
  </div>
</div>

<!-- ======================== -->
<!-- ROOM PAGE                -->
<!-- ======================== -->
<div id="roomPage" class="page">
  <div class="board-panel wide">
    <h2 id="roomTitle" class="title-board"></h2>

    <div id="playerList" class="player-list-board"></div>

    <div class="room-bottom-row">
      <button id="readyBtn" class="btn-main">게임 준비</button>
      <button id="startGameBtn" class="btn-green" style="display:none;">게임 시작</button>
      <button id="copyInviteBtn" class="btn-sub">초대 링크 복사</button>
    </div>
  </div>
</div>

<!-- ======================== -->
<!-- GAME PAGE                -->
<!-- ======================== -->
<div id="gamePage" class="page">

  <h2 id="roundInfo" class="title-board"></h2>

  <div class="game-layout">

    <!-- 플레이어 리스트 -->
    <div id="gamePlayerList" class="sideBoard"></div>

    <!-- 메인 보드 -->
    <div class="mainBoard">

      <h3 class="section-title">테이블</h3>
      <div id="tableArea" class="tableBoard"></div>

      <h3 class="section-title">내 패 (<span id="myCount">0</span>)</h3>

      <!-- 패 방향 선택 -->
      <div id="flipSelectArea" class="flip-area hidden">
        <h3 class="section-title">패 방향 선택</h3>
        <button id="flipToggleBtn" class="btn-main">↺ 방향 바꾸기</button>
        <br><br>
        <button id="flipConfirmBtn" class="btn-green" style="margin-top:10px;">
          ✔ 방향 확정
        </button>
      </div>

      <!-- 손패 -->
      <div id="handArea" class="handBoard"></div>

      <!-- 버튼 -->
      <div class="action-row">
        <button id="showBtn" class="btn-main same">SHOW</button>
        <button id="scoutBtn" class="btn-orange same">SCOUT</button>
        <button id="showScoutBtn" class="btn-purple same">SHOW & SCOUT</button>
      </div>
    </div>
  </div>

  <!-- SCOUT 모달 -->
  <div id="scoutModal" class="modal hidden">
    <div class="modal-box">
      <p style="margin-bottom:12px;">어떻게 가져올까요?</p>
      <button id="modalKeep" class="btn-green small">그대로 가져오기</button>
      <button id="modalReverse" class="btn-orange small">반대로 가져오기</button>
      <br><br>
      <button id="modalClose" class="btn-sub small">닫기</button>
    </div>
  </div>

  <!-- 삽입 위치 모달 -->
  <div id="insertModal" class="modal hidden">
    <div class="modal-box" id="insertModalContent"></div>
  </div>

</div>

<!-- SOCKET.IO -->
<script src="/socket.io/socket.io.js"></script>

<!-- MODULES -->
<script type="module" src="./socket.js"></script>
<script type="module" src="./roomUI.js"></script>
<script type="module" src="./gameUI.js"></script>

<!-- ========================================================= -->
<!-- 초대 링크 자동 입장 (닉네임 2번 입력되는 문제 해결)       -->
<!-- ========================================================= -->
<script>
window.addEventListener("DOMContentLoaded", () => {
  const params = new URLSearchParams(location.search);
  const invitedRoom = params.get("room");

  if (invitedRoom) {
    // 여기서는 닉네임을 묻지 않음!! (중복입력 방지)
    window.roomId = invitedRoom;

    // 초대 손님은 항상 새로운 permUid 생성
    window.permUid = crypto.randomUUID();

    // 닉네임은 socket.js에서 단 한 번만 입력받음
    window.showPage("startPage");

    // 자동으로 닉네임 입력창에 포커스
    document.getElementById("nicknameInput").focus();

    // 방 번호 표시
    roomTitle.innerText = `방번호: ${invitedRoom}`;
  }
});
</script>

</body>
</html>
